#!/bin/bash
# P2P対戦テスト用
# Usage: tools/p2p [web|native]  (default: web)

MODE="${1:-web}"

# matchbox_server が無ければ起動
if ! pgrep -f matchbox_server > /dev/null; then
  echo "matchbox_server を起動..."
  matchbox_server &
  sleep 1
fi

case "$MODE" in
  web)
    echo "=== Web P2P テスト ==="
    echo "ブラウザで2つのタブを開いてテストしてください"
    echo "  Ctrl+C で終了"
    echo ""
    bevy run web
    ;;
  native)
    echo "=== Native P2P テスト ==="
    echo "Client 1 (BRP port 15702) 起動..."
    cargo run --features dev -- --brp-port=15702 &
    sleep 2
    echo "Client 2 (BRP port 15703) 起動..."
    cargo run --features dev -- --brp-port=15703 &
    wait
    ;;
  *)
    echo "Usage: tools/p2p [web|native]"
    exit 1
    ;;
esac
